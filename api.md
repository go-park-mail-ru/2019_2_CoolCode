## 0. Cущности
### 0.1 Пользователь
```json
{
     "id":"int",
     "email":"string",
     "password":"string",
     "username":"string",
     "name":"string",
     "status":"string",
     "phone":"string"
}
```
    
| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `username`    | Логин  пользователя. |
| `password`    | Пароль пользователя |
| `id`     | Id пользователя |
| `email`     | Email пользователя |
| `name`     | Реальное имя пользователя |
| `status`     | Статус пользователя |  
| `phone`     | Телефон пользователя |  

### 0.2 Чат(1-1)
```json
{
  "id":"int",
  "name": "string",
  "totalMsgCount": "int",
  "members": ["int"],
  "lastMessage": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`    | Уникальный идентификатор чата. |
| `name`    | Название чата(имя собеседника) |
| `totalMsgCount`     | Количество новых сообщений на момент запроса |
| `members`     | id пользователей, имеющих доступ к чату(2 числа) |
| `lastMessage`     | Текст последнего сообщения в чате |

### 0.3 Канал
```json
{
  "id": "int",
  "name": "string",
  "totalMsgCount": "int", 
  "members": ["int"],
  "admins": ["int"],
  "creator": "int"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`    | Уникальный идентификатор канала. |
| `name`    | Название канала |
| `totalMsgCount`     | Количество новых сообщений на момент запроса |
| `members`     | id пользователей, имеющих доступ к каналу |
| `admins`     | id пользователей, имеющих доступ к редактировнию канала|
| `creator`     | id пользователя, создавшего канал|

### 0.4 Workspace
```json
{
  "id": "int",
  "name": "string",
  "channels":  [{
      "id": "int",
      "name": "string",
      "totalMsgCount": "int", 
      "members": ["int"],
      "admins": ["int"],
      "creator": "int"
  }], 
  "members": ["int"],
  "admins": ["int"],
  "creator": "int"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`    | Уникальный идентификатор workspace. |
| `name`    | Название workspace |
| `channels`    | Массив каналов внутри workspace |
| `members`     | id пользователей, имеющих доступ к workspace |
| `admins`     | id пользователей, имеющих доступ к редактировнию workspace|
| `creator`     | id пользователя, создавшего workspace|

### 0.5 Message
```json
{
  "id": "int",
  "type": "int",
  "text": "string",
  "file_id": "int",
  "message_time": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`    | Уникальный идентификатор message. |
| `type`    | Тип сообщения.(1-Текст, 2-Фото)|
| `text`    | Текст сообщения(при типе сообщения 1)|
| `file_id`    | id файла(при типе сообщения 2)|
| `message_time`    | Время сообщения в формате 02.01.2006 15:04|








## 1. Общие положения

Все запросы посылаются на сервер <тут адрес>. Если запрос не содержит в себе тело, то он `GET`, иначе `POST`

### 1.1 Типы http кодов, возвращаемых сервером в ответе

| Код       | Описание |                                                                                                                                                            
| -------------- | -------------------------------------------------------------------------------|
| `200`      | Успех. |
| `400`    | Неверные данные в запросе (неправильный логин/пароль, несуществующий ID заданий, пользователей). Тело ответа дополнительно содержит мнемокод с описанием ошибки, завернутый в JSON.|
| `401`      | Клиент не авторизован. |
| `403`      | Клиент не имеет доступ к данному запросу. |
| `405`      | Неверный метод (например, `POST` вместо `GET` для `/get_school_list`). `GET` используется в тех запросах, где не надо посылать json в теле |
| `500`      | Фатальная ошибка на сервере. |

# 2. Пользователь

### 2.1 Регистрация

Ниже указан запрос клиента на авторизацию.

Запрос `/users` типа POST

```json
{
    "email": "string",
    "password": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `email`       | Email нового пользователя. |
| `password`     | Пароль нового пользователя |

Запрос так же может содержать любые другие поля пользователя

Ответ на запрос: код ошибки


### 2.2 Авторизация

Ниже указан запрос клиента на авторизацию.

Запрос `POST` `login`

```json
{
    "email": "string",
    "password": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `email`       | Email  пользователя. |
| `password`     | Пароль пользователя |

Ответ на запрос:

Заголовок ответа содержит ключ `Set-Cookie`. Значение - ключ  - session_id.

```json
 {
      "id":"int",
      "email":"string",
      "username":"string",
      "name":"string",
      "status":"string"
 }
```
    
  | Ключ          | Значение                                                                                                                                                                                                                                                                               |
    | ------------- | ----------------------------------------- |
    | `username`    | Логин  пользователя. |
    | `id`     | Id пользователя |
    | `email`     | Email пользователя |
    | `name`     | Реальное имя пользователя |
    | `status`     | Статус пользователя |  
    
### 2.3 Проверка сессии

Ниже указан запрос клиента на авторизацию.

Запрос `GET` `/users`

Ответ на запрос:

Заголовок ответа содержит ключ `Set-Cookie`. Значение - ключ  - session_id.

```json
 {
      "id":"int",
      "email":"string",
      "username":"string",
      "name":"string",
      "status":"string"
 }
```
    
  | Ключ          | Значение                                                                                                                                                                                                                                                                               |
    | ------------- | ----------------------------------------- |
    | `username`    | Логин  пользователя. |
    | `id`     | Id пользователя |
    | `email`     | Email пользователя |
    | `name`     | Реальное имя пользователя |
    | `status`     | Статус пользователя |  
        
### 2.3 Выход

Выход есть отвязка соединения от устройства и аккаунта.

Запрос `DELETE` `/logout` 

Ответ на запрос:

Код http `200` в случае успеха, а код, описывающий ошибку, в ином случае.

После после получения ответа этого типа неуместны никакие другие запросы, кроме `/login`,`/sign_up`.

### 2.4 Запрос информации о пользователе

Запрос `GET` `/users/{id}`. Доступен только для авторизированного пользователя

Ответ:
```json
 {
      "id":"int",
      "email":"string",
      "username":"string",
      "name":"string",
      "status":"string"
 }
```

### 2.5 Запрос информации о пользователе

Запрос `GET` `/users`. Доступен только для авторизированного пользователя. Возвращает пользователя, привязанного к текущей сессии.

Ответ:
```json
 {
      "id":"int",
      "email":"string",
      "username":"string",
      "name":"string",
      "status":"string"
 }
```

### 2.6 Редатирование профиля
Редактирование полей профиля
    
Запрос `/users/id` типа PUT 
    
Тело запроса должно содержать ВСЕГО пользователя, а не только редактируемые поля
    
```json
 {
      "id":"int",
      "email":"string",
      "username":"string",
      "name":"string",
      "status":"string"
 }
```
    
    
### 2.6 Получение аватарки
Запрос /photos/{id} типа GET

Ответ: multipart/form-data

    
### 2.7 Загрузка аватарки
Запрос /photos типа POST

Тип данных multipart/form-data

Ответ: код ошибки

### 2.8 Поиск пользователей по username
Запрос /users/<name> типа GET

Ответ содержит всех пользователей, username которые содержит <name>
```json
{
  "users":[
    {
           "id":"int",
           "email":"string",
           "password":"string",
           "username":"string",
           "name":"string",
           "status":"string",
           "phone":"string"
    }
  ]
}
```



# 3 Чаты

### 3.1 Cоздание чата
Запрос /chats типа POST

Тело запроса:
```json
{
  "user_id": "int"
} 
```
//TODO: CHAT JSON

### 3.2 Получение чата
Запрос /chats/{id} типа GET

Тело ответа:
```json
{
  "id":"int",
  "name": "string",
  "totalMsgCount": "int",
  "members": ["int"]
  
}
```



###3.3 Получение чатов пользователя
Запрос /users/{id}/chats типа GET

Тело ответа:
```json
{
  "chats": [
    {
      
    }
  ],
  "workspaces": [
      {
      
      }
  ]
}
```

### 3.4 Подписаться на уведомления чата
 Websocket запрос chats/{id}/notifications
 
### 3.5 Удалить чат
 Запрос `/chats/{id}` `DELETE`
 
 Ответ: код ошибки
 
# 4 Workspaces

### 4.1 Создание workspace 

Запрос `POST` `/workspaces`

```json
{
  "name": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `name`       | Название workspace. |

Тело ответа:
```json
{
  "id": "int",
  "name": "string",
  "channels":  [{
      "id": "int",
      "name": "string",
      "totalMsgCount": "int", 
      "members": ["int"],
      "admins": ["int"],
      "creator": "int"
  }], 
  "members": ["int"],
  "admins": ["int"],
  "creator": "int"
}
```

### 4.2 Получение workspace
Запрос /workspaces/{id} типа GET

Тело ответа:
```json
{
  "id": "int",
  "name": "string",
  "channels":  [{
      "id": "int",
      "name": "string",
      "totalMsgCount": "int", 
      "members": ["int"],
      "admins": ["int"],
      "creator": "int"
  }], 
  "members": ["int"],
  "admins": ["int"],
  "creator": "int"
}
```

### 4.3 Редактирование workspace
Запрос типа `PUT` `workspaces/{id}`. Доступ имеют только админы workspace

`````json
{
  "id": "int",
  "name": "string",
  "members": ["int"],
  "admins": ["int"]
}
`````

### 4.4 Выход из workspace

Запрос `DELETE` `/workspaces/{id}/members`


| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`       | id workspace |

### 4.5 Удаление workspace
Доступ к запросу имеет только создатель workspace
Запрос `DELETE` `/workspaces/{id}`


| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`       | id workspace |

# 5 Каналы

### 5.1 Создание канала 
Запрос `POST` `/workspaces/{id}/channels`

```json
{
   "name": "string"
}
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `name`       | Название канала. |

Ответ:

```json
{
  "id": "int"
}
```

### 5.2 Редактирование канала
Запрос типа `PUT` `channels/{id}`. Доступ имеют только админы канала

```json
{
  "id": "int",
  "name": "string",
  "members": ["int"],
  "admins": ["int"]
}
```

### 5.3 Получение канала
Запрос /channels/{id} типа GET

Тело ответа:
```json
{
  "id": "int",
  "name": "string",
  "totalMsgCount": "int", 
  "members": ["int"],
  "admins": ["int"],
  "creator": "int"
}
```

### 5.4 Выход из канала

Запрос `DELETE` `/channels/{id}/members`


| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`       | id канала |

### 5.5 Удаление канала
Доступ к запросу имеет только создатель канала
Запрос `DELETE` `/channels/{id}`


| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `id`       | id канала |

# 6 Сообщения

### 6.1 Добавить текстовое сообщение в чат
    Запрос `POST` `chats/{id}/messages'
    
   ```json
        {
          "text": "string"
        }
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `text`       | текст сообщения|


### 6.1 Добавить текстовое сообщение в канал
    Запрос `POST` `channels/{id}/messages'
    
   ```json
        {
          "text": "string"
        }
```

| Ключ          | Значение                                                                                                                                                                                                                                                                               |
| ------------- | ----------------------------------------- |
| `text`       | текст сообщения|

### 6.2 Получить сообщения чата(канала)
 Запрос `GET` `chats/{id}/messages`
    
 Тело ответа 
 ```json
    {
      "messages": [
        { 
          
        } 
      ] 
    }
```

### 6.3 Изменить сообщение
 Запрос `PUT` `messages/{message_id}`
    
 ```json
    {
        "text": "string"
    }
 ```
 
 | Ключ          | Значение                                                                                                                                                                                                                                                                               |
 | ------------- | ----------------------------------------- |
 | `text`       | текст сообщения|
### 6.4 Удалить сообщение
 Запрос `DELETE` `messages/{message_id}`
### 6.5 Удалить сообщение(только для автора)
 Запрос `DELETE` `messages/{message_id}?forAuthor=true`
 














 


    
    
    
